var particles=[],wall=[],wallUp=[],wallBot=[],molecules=[],ensemble="nvt",dimension="2d",Np=50,Nps=[50],mols=["Simple"],temp=1,press=1,rcut=2.5,rcutsq=rcut**2,sig=1,eps=1,dt=.001,dens=.01,Lbox=Math.pow(Np/dens,1/3),Lbox=new THREE.Vector3(Lbox,Lbox,Lbox),simBox={},time=0,timeSteps=0,rijsqMin=1,sigMixMin=1;class Molecule{constructor(e,t,n,o){this.atoms=e,this.bonds=t,this.bends=n,this.isWall=o}copy(e,t){let n=[];for(const o of this.atoms)n.push(o.copy(e,t));return new Molecule(n,this.bonds,this.bends,this.isWall)}}class Atom{constructor(e,t,n,o,r,s,l,a){this.r=e,this.v=t,this.q=n,this.sig=o,this.eps=r,this.rcut=s,this.color=l,this.viewSize=a,this.a=new THREE.Vector3(0,0,0),this.ap=new THREE.Vector3(0,0,0),this.f=new THREE.Vector3(0,0,0),this.fp=new THREE.Vector3(0,0,0)}copy(e,t){return new Atom(this.r.clone().add(e),this.v.clone().add(t),this.q,this.sig,this.eps,this.rcut,this.color,this.viewSize)}}function SimInit(){let r=new THREE.Vector3;var e=Math.round(Math.pow(Np,1/3)),s=(e="2d"==dimension?Math.round(Math.pow(Np,.5))+1:e)*sig*2>Lbox.x?Lbox.x/e:2*sig,l=s*e/2,a=createTypesArray();setInputForm(),molecules=[],wallBot=[],wallUp=[],particles=[],wall=[];let i=0;var n=0;if("2d"==dimension){for(let n=1;n<e;n++){for(let t=0;t<e;t++){let e=new THREE.Vector3(0,0,0).random();if(e.setZ(0).normalize(),e.multiplyScalar(temp),r.add(e),molecules.push(molTemplates[a[i]].copy(new THREE.Vector3(-l+t*s,-l+n*s,0),e)),i++,i>=Np)break}if(i>=Np)break}if(ensemble.includes("_wall")){var o=Math.ceil(Lbox.x),c=Lbox.x/o;console.log(o,c);for(let t=0;t<2;t++)for(let e=0;e<o;e++)(t?wallUp:wallBot).push(molTemplates.Wall.copy(new THREE.Vector3(.5*c-.5*Lbox.x+e*c,-.5*Lbox.y+t*(Lbox.y-c),0),new THREE.Vector3(0,0,0)))}}else if("3d"==dimension){for(let o=0;o<e;o++){for(let n=0;n<e;n++){for(let t=0;t<e;t++){let e=new THREE.Vector3(0,0,0).random();if(e.multiplyScalar(temp),r.add(e),molecules.push(molTemplates[a[i]].copy(new THREE.Vector3(-l+n*s,-l+o*s,-l+t*s),e)),i++,i>=Np)break}if(i>=Np)break}if(i>=Np)break}if(console.log("Np / Nact",Np,i),ensemble.includes("_wall")){var m=Math.ceil(Lbox.x),p=Lbox.x/m;console.log(m**2,p);for(let n=0;n<2;n++)for(let t=0;t<m;t++)for(let e=0;e<m;e++)(n?wallUp:wallBot).push(molTemplates.Wall.copy(new THREE.Vector3(.5*p-.5*Lbox.x+t*p,-.5*Lbox.y+n*(Lbox.y-p),t%2*.5*p-.5*Lbox.z+e*p),new THREE.Vector3(0,0,0)))}}wall=wallUp.concat(wallBot),particles=molecules.concat(wall),n/=molecules.length,r.divideScalar(molecules.length);for(let t=0;t<molecules.length;t++)for(let e=0;e<molecules[t].atoms.length;e++)molecules[t].atoms[e].v.sub(r),molecules[t].atoms[e].q-=n;return pbc=ensemble.includes("wall")?pbc_wall:pbc_normal,!0}function createTypesArray(){let n=[];for(let t=0;t<mols.length;t++)for(let e=0;e<Nps[t];e++)n.push(mols[t]);return n}function getActTemp(){let n=0;for(let t=0;t<particles.length;t++)for(let e=0;e<particles[t].atoms.length;e++)n+=particles[t].atoms[e].v.lengthSq();return n/="2d"===dimension?2*particles.length-2:3*particles.length-3,n}function thermostat(){return FrictionThermostat(),!0}function ScaleVelocitiesThermostat(){var n=Math.sqrt(temp/tempAct);for(let t=0;t<particles.length;t++)for(let e=0;e<particles[t].atoms.length;e++)particles[t].atoms[e].v.multiplyScalar(n)}function FrictionThermostat(){var n=Math.sqrt(1+.05*(temp/tempAct-1));for(let t=0;t<particles.length;t++)for(let e=0;e<particles[t].atoms.length;e++)particles[t].atoms[e].v.multiplyScalar(n)}function randNormal(){var e=Math.random(),t=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*t)}function omgDPD(e,t){return 1-e/t}function dpdThermostat(e,t){if(e<5)return 0;var n=0,e=omgDPD(e,5)**2;return n-=5*e*t,n+=Math.sqrt(2*temp*5*e*dt)*randNormal()}function barostat(){FrictionBarostat();let e=Lbox.x*Lbox.y;return"3d"==dimension&&(e*=Lbox.z),densAct=Np/e,!0}function FrictionBarostat(){let n=Math.cbrt(1-2e-4*(press-pressAct));"2d"==dimension&&(n=Math.sqrt(1-2e-4*(press-pressAct))),Lbox.multiplyScalar(n),simBox.setFromObject(createSimBox());for(let t=0;t<molecules.length;t++)for(let e=0;e<molecules[t].atoms.length;e++)molecules[t].atoms[e].r.multiplyScalar(n);return!0}function findValuesForAdaptivTimeStepFuncion(e,t){e<rijsqMin&&(rijsqMin=e,sigMixMin=t)}function adaptivTimeStep(e,t){t=1-Math.sqrt(e)/t;.02<t?dt*=.99:t<.001&&(dt*=1.01),.005<(dt=dt<1e-4?1e-4:dt)&&(dt=.005)}function mixingRules(e,t,n,o){return[Math.min(e,n),Math.sqrt(t*o)]}function lj_f(e,t,n,o,r){[n,o]=mixingRules(t,n,o,r);r=n**2/e;return findValuesForAdaptivTimeStepFuncion(e,n),24*o*(2*r**6-r**3)/e}function lj_u(e,t,n,o,r){e=(.5*(t+o))**2/e;return 4*Math.sqrt(n*r)*(e**6-e**3)}function coul_f(e,t,n){return e*t/n**2}function coul_u(e,t,n){return e*t/n}function bond_f(e,t,n){return-.5*e*(n-t)}function bond_u(e,t,n){return e*(n-t)**2}function bend_f(e,t,n){return-.5*e*(n-t)}function bend_u(e,t,n){return e*(n-t)**2}function pbc_wall(e){const t=(new THREE.Vector3).copy(Lbox).setY(1e3),n=(new THREE.Vector3).copy(e);return t.multiply(n.divide(t).round())}function pbc_normal(e){const t=(new THREE.Vector3).copy(Lbox),n=(new THREE.Vector3).copy(e);return t.multiply(n.divide(t).round())}molTemplates={Simple:new Molecule([new Atom(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0),0,1,1,2.5,30668,.5)],null,null,!1),Wall:new Molecule([new Atom(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0),0,1,1,1,10092424,.5)],null,null,!0),Repulsive_only:new Molecule([new Atom(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0),0,1,1,1,52343,.5)],null,null,!1),Ar:new Molecule([new Atom(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0),0,1,1,2.5,30668,.5)],null,null,!1)};var pbc=pbc_normal;function force(){var e,t=particles.length,n=molecules.length,o=wallUp.length;let r,s,l,a,i,c,m,p;for(r=0;r<n;r++)for(s=0;s<molecules[r].atoms.length;s++)molecules[r].atoms[s].a.set(0,0,0);for(wallUp[0]&&("2d"==dimension?wallUp[0].atoms[0].a.add((new THREE.Vector3).set(0,-press*Lbox.x,0)):wallUp[0].atoms[0].a.add((new THREE.Vector3).set(0,-press*Lbox.x**2,0))),wallBot[0]&&wallBot[0].atoms[0].a.set(0,0,0),r=1;r<o;r++)wallUp[r].atoms[0].a=wallUp[0].atoms[0].a,wallBot[r].atoms[0].a=wallBot[0].atoms[0].a;for(pressAct=PEAct=0,r=0;r<n;r++)for(l=0;l<particles[r].atoms.length;l++)for(s=r+1;s<t;s++)for(a=0;a<particles[s].atoms.length;a++)i=(new THREE.Vector3).subVectors(particles[r].atoms[l].r,particles[s].atoms[a].r),i.sub(pbc(i)),c=Math.min(particles[r].atoms[l].rcut,particles[s].atoms[a].rcut),p=i.lengthSq(),rcutsq<p||c<p||(e=lj_f(p,particles[r].atoms[l].sig,particles[r].atoms[l].eps,particles[s].atoms[a].sig,particles[s].atoms[a].eps),e+=coul_f(particles[r].atoms[l].q,particles[s].atoms[a].q,p),PEAct+=lj_u(p,particles[r].atoms[l].sig,particles[r].atoms[l].eps,particles[s].atoms[a].sig,particles[s].atoms[a].eps),PEAct+=coul_u(particles[r].atoms[l].q,particles[s].atoms[a].q,p),m=i.normalize().multiplyScalar(e),particles[r].atoms[l].a.add(m.multiplyScalar(1)),particles[s].atoms[a].a.add(m.multiplyScalar(-1)),s<n&&(pressAct+=i.dot(m)));if(wallUp[0]&&wallUp[0].atoms[0].a.divideScalar(o),PETailAct=8/3*dens*Math.PI*eps*sig**3*((sig/rcut)**9/3-(sig/rcut)**3),PEAct+=PETailAct,PEAct/=t,wallUp[0]){let e=(wallUp[0].atoms[0].r.y-wallBot[0].atoms[0].r.y)*Lbox.x;"3d"===dimension&&(e*=Lbox.z),densAct=Np/e}return pressAct/="2d"==dimension?2*Lbox.x*Lbox.y:3*Lbox.x*Lbox.y*Lbox.z,pressAct+=16/3*densAct**2*Math.PI*eps*sig**3*((sig/rcut)**9*2/3-(sig/rcut)**3),pressAct+=densAct*tempAct,!0}function crashTest(){for(let t=0;t<particles.length;t++)for(let e=0;e<particles[t].atoms.length;e++)if(isNaN(particles[t].atoms[e].r.x)||isNaN(particles[t].atoms[e].r.y)||isNaN(particles[t].atoms[e].r.z)||!isFinite(particles[t].atoms[e].r.x)||!isFinite(particles[t].atoms[e].r.y)||!isFinite(particles[t].atoms[e].r.z))return console.error("Simulation Error"),!0;return!1}function newPosition(){var e=particles.length;let t,n;for(t=0;t<e;t++)for(n=0;n<particles[t].atoms.length;n++)particles[t].atoms[n].r.add((new THREE.Vector3).copy(particles[t].atoms[n].v).multiplyScalar(dt)).add((new THREE.Vector3).copy(particles[t].atoms[n].a).multiplyScalar(.5*dt**2)),particles[t].atoms[n].r.sub(pbc(particles[t].atoms[n].r));"npt"!=ensemble&&"nph"!=ensemble||barostat()}function newVelocity(){var e=particles.length,t=molecules.length,n=wallUp.length;let o,r;KEAct=0;let s=[];for(o=0;o<t;o++)for(r=0;r<molecules[o].atoms.length;r++)molecules[o].atoms[r].v.add((new THREE.Vector3).copy(molecules[o].atoms[r].a).add(molecules[o].atoms[r].ap).multiplyScalar(.5*dt)),KEAct+=.5*molecules[o].atoms[r].v.lengthSq(),molecules[o].atoms[r].ap.copy(molecules[o].atoms[r].a),s.push(molecules[o].atoms[r].v.length());for(o=0;o<n;o++)for(r=0;r<wallUp[o].atoms.length;r++)wallBot[o].atoms[r].a.set(0,0,0),wallUp[o].atoms[r].a.setX(0).setZ(0),wallUp[o].atoms[r].v.add((new THREE.Vector3).copy(wallUp[o].atoms[r].a).add(wallUp[o].atoms[r].ap).multiplyScalar(.5*dt)),KEAct+=.5*wallUp[o].atoms[r].v.lengthSq(),wallUp[o].atoms[r].ap.copy(wallUp[o].atoms[r].a);KEAct/=e,computeVDist(s),tempAct=getActTemp(),"nvt"!=ensemble&&"npt"!=ensemble&&"npzt_wall"!=ensemble||thermostat()}function zeroTotalMomentum(){let n=new THREE.Vector3;n.divideScalar(molecules.length);for(let t=0;t<molecules.length;t++)for(let e=0;e<molecules[t].atoms.length;e++)n.add(molecules[t].atoms[e].v);n.divideScalar(molecules.length);for(let t=0;t<molecules.length;t++)for(let e=0;e<molecules[t].atoms.length;e++)molecules[t].atoms[e].v.sub(n)}function computeVDist(t){var e=Math.max(...t),n=Math.round(.25*Np),o=e/n;vDist=new Array(n+1);for(let e=0;e<vDist.length;e++)vDist[e]=0;for(let e=0;e<t.length;e++)j=Math.floor(t[e]/o),vDist[j]++}const SvgClosure=function(){const o=document.getElementById("graphs");let r=0,m=0,p,s=0,e=!1,l=[],u="";const d="http://www.w3.org/2000/svg";function h(e){var t="",n=e[0],o=e[1]-10;return t+="M "+n+" "+(m-e[1]),t+="L "+n+" "+o,t+="M "+n+" "+o,t+="L "+(n+10)+" "+(20+o),t+="M "+n+" "+o,t+="L "+(n-10)+" "+(20+o)}function f(e){var t="",n=m+e[0]-10,o=m-e[1];return t+="M "+e[0]+" "+o,t+="L "+n+" "+o,t+="M "+n+" "+o,t+="L "+(n-20)+" "+(o-10),t+="M "+n+" "+o,t+="L "+(n-20)+" "+(10+o)}function E(e,t,n){let o=document.createElementNS(d,"path");return o.setAttribute("d",e),o.setAttribute("stroke-width",n),o.setAttribute("stroke",t),o.setAttribute("fill","transparent"),o}function g(n){if(s++,e)return s>=l.length&&(s=0),l[s].lastChild;{let e=document.createElement("div");e.setAttribute("class","graphs__div--graph"),e.dataset.id=s,e.addEventListener("click",()=>{let e=event.currentTarget.lastChild;"250px"==e.getAttribute("width")?e.setAttribute("width","0px"):e.setAttribute("width","250px")});let t=document.createElement("header");return t.setAttribute("class","graph--head"),t.innerText=u,t.innerHTML+=' <span class="helpIcon"><div class="helpText">'+n+"</div></span>",e.appendChild(t),p=document.createElementNS(d,"svg"),p.setAttribute("width","0px"),p.setAttribute("height","150px"),p.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.appendChild(p),o.appendChild(e),r=250,m=150,l.push(e),p}}function t(t,n,e,o){u=e,p=g(o);let r="";r+=f(t),r+=h(t),p.appendChild(E(r,"black",3));var s=Math.min(...timeInTime),l=Math.max(...n),a=Math.min(...n),e=n.reduce((e,t)=>t+=e),e=roundOutput(e/=n.length,1e5),i=Math.max(...timeInTime)-s||1,c=a-l||1;r="M "+((m-30)*(timeInTime[0]-s)/i+t[0])+" "+((m-40)*(n[0]-l)/c+t[1]+20);for(let e=1;e<timeInTime.length;e++)r+="L "+((m-30)*(timeInTime[e]-s)/i+t[0])+" "+((m-40)*(n[e]-l)/c+t[1]+20);p.appendChild(E(r,"red",3)),text=document.createElementNS(d,"text"),text.setAttribute("x",10),text.setAttribute("y",30),text.innerHTML=l,p.appendChild(text),text=document.createElementNS(d,"text");o=(m-40)*(e-l)/c+t[1]+20;text.setAttribute("x",10),text.setAttribute("y",o),text.innerHTML=e,p.appendChild(text),r=document.createElementNS(d,"line"),r.setAttribute("x1",80),r.setAttribute("y1",o),r.setAttribute("x2",m+50),r.setAttribute("y2",o),r.setAttribute("stroke","black"),r.setAttribute("stroke-dasharray","4"),p.appendChild(r),text=document.createElementNS(d,"text"),text.setAttribute("x",10),text.setAttribute("y",m-10),text.innerHTML=a,p.appendChild(text)}function n(){offsetX=80,offsetY=10,function(o,r,e,t){u=e,p=g(t);let s="";if(s+=f(o),s+=h(o),p.appendChild(E(s,"black",3)),r[0]){let t=new Array(r[0].length),e,n;for(e=0;e<t.length;e++)t[e]=0;for(e=0;e<r.length;e++)for(n=0;n<r[e].length;n++)t[n]+=r[e][n];for(e=0;e<t.length;e++)t[e]/=r.length;var l=Math.max(...t),a=t.length,i=Math.min(...t)-l||1;s="M "+o[0]+" "+((m-40)*(t[0]-l)/i+o[1]+20);for(let e=1;e<t.length;e++)s+="L "+((m-30)*e/a+o[0])+" "+((m-40)*(t[e]-l)/i+o[1]+20);p.appendChild(E(s,"red",3))}}([40,offsetY],vDistInTime,"Distribuce rychlostí","<p>Distribuce rychlostí ukazuje jaký podíl částic má jakou rychlost. Po čase by se měla distribuce ustálit a již se příliž neměnit. Distribuce by měla odpovídat Maxwelovu-Boltzmanuvu rozdělení rychlostí.</p>"),t([offsetX,offsetY],tempInTime,"T(t)","<p>Graf závislosti teploty na čase. Teplota by se měla ustálit na rovnovážné hodnotě, popř. na hodnotě, kterou jste nastavili. Kolem této hodnot by měla hodnota oscilovat.</p>"),t([offsetX,offsetY],PEInTime,"PE(t)","<p>Celková potenciální energie částic.</p>"),t([offsetX,offsetY],KEInTime,"KE(t)","<p>Celková kinetická energie částic.</p>"),t([offsetX,offsetY],EtotInTime,"Etot(t)","<p>Součet celkové potenciální a celkové kinetické energie. V případě simulací **E nebo **H bude hodnota oscilovat kolem rovnovážné hodnoty.</p>"),t([offsetX,offsetY],pressInTime,"P(t)","<p>Graf závislosti tlaku na čase. Tlak by se měla ustálit na rovnovážné hodnotě, popř. na hodnotě, kterou jste nastavili. Kolem této hodnot by měla hodnota oscilovat. POZOR: Pro tento případ se stěnou je výpočet tlaku špatně. Simulace se kvalitativně chová správně, ale dává špatné výsledky. Ovlivněny budou další veličiny(PE, hustota, ...).</p>"),t([offsetX,offsetY],densInTime,"Hustota(t)","<p>Graf závislosti hustoty na čase. Hutota by se měla ustálit na rovnovážné hodnotě, popř. na hodnotě, kterou jste nastavili. Pro simulace NP* bude hustota oscilovat kolek rovnovážné hodnoty.</p>"),e=!0}return function(){!function(){let t=o.getElementsByTagName("svg");for(let e=0;e<t.length;e++)for(;t[e].firstChild;)t[e].removeChild(t[e].lastChild)}(),n()}};var clearAndInitSvg,timeInTime=[0],tempInTime=[0],pressInTime=[0],KEInTime=[0],PEInTime=[0],densInTime=[0],EtotInTime=[0],vDistInTime=[],tempAct=temp,KEAct=0,PEAct=0,PETailAct=0,densAct=dens,pressAct=press,vDist=[0],nReduce=100;function output_init(){(clearAndInitSvg=SvgClosure())()}function OutputInit(){timeInTime=[],tempInTime=[],pressInTime=[],KEInTime=[],PEInTime=[],densInTime=[],EtotInTime=[],vDistInTime=[],vDist=[pressAct=densAct=PETailAct=PEAct=KEAct=tempAct=0]}function roundOutput(e,t){return Math.round(e*t)/t}function timeSeriesFilter(e,t){return timeSeriesHelper[t]%reductionConstant<=.1*reductionConstant}function reduceTimeSeriesLength(){timeInTime=timeInTime.slice(1),tempInTime=tempInTime.slice(1),densInTime=densInTime.slice(1),pressInTime=pressInTime.slice(1),KEInTime=KEInTime.slice(1),PEInTime=PEInTime.slice(1),EtotInTime=EtotInTime.slice(1),vDistInTime=vDistInTime.slice(1)}function pushTimeSeries(e,t,n,o,r,s,l){timeInTime.push(time),tempInTime.push(e),densInTime.push(s),pressInTime.push(t),KEInTime.push(n),PEInTime.push(o),EtotInTime.push(r),vDistInTime.push(l)}function printOutput(){pushTimeSeries(roundOutput(tempAct,1e5),roundOutput(pressAct,1e5),roundOutput(KEAct,1e5),roundOutput(PEAct,1e5),roundOutput(KEAct+PEAct,1e5),roundOutput(densAct,1e5),vDist),timeInTime.length>=nReduce&&reduceTimeSeriesLength(),clearAndInitSvg()}function getFormsInputs(){return{temp:document.getElementById("input--temp"),press:document.getElementById("input--press"),lbox:document.getElementById("input--lbox"),dens:document.getElementById("input--dens"),nofp:document.querySelectorAll("#form__input--molecules input"),mols:document.querySelectorAll("#form__input--molecules select"),ensemble:document.querySelectorAll('input[name="ensemble"]'),dimension:document.querySelectorAll('input[name="dimesnion"]'),tempDiv:document.getElementById("form__input--temp"),pressDiv:document.getElementById("form__input--press")}}function getEnsemble(e){let t="nve";return e.forEach(e=>{e.checked&&(t=e.value)}),t}function getFormsRanges(){return{temp:document.getElementById("range--temp"),press:document.getElementById("range--press")}}function setInputForm(){setFormsInputs(),setFormsRanges()}function setFormsInputs(){let e=getFormsInputs();e.temp.value=temp,e.press.value=press,e.dens.value=dens,e.lbox.value=Lbox.x}function setFormsRanges(){let e=getFormsRanges();e.temp.value=temp,e.press.value=press}function getMols(e){let t=[];for(const n of e.mols)t.push(n.value);return t}function getNps(e){let t=[];for(const n of e.nofp)t.push(n.value);return t}function getNp(e){let t=0;for(const n of e.nofp)t+=+n.value;return t}function readTempInputFrom(){var e=getFormsInputs();temp=Number(e.temp.value)}function readPressInputFrom(){var e=getFormsInputs();press=Number(e.press.value)}function readInputForm(){let e=getFormsInputs();readTempInputFrom(),readPressInputFrom(),dens=Number(e.dens.value),mols=getMols(e),Nps=getNps(e),Np=getNp(e),Lbox.x=Number(e.lbox.value),Lbox.y=Lbox.x,Lbox.z=Lbox.x,ensemble=getEnsemble(e.ensemble),e.dimension.forEach(e=>{e.checked&&(dimension=e.value)})}function onInputDens(e){let t=getFormsInputs();t.lbox.value=Math.pow(Np/parseFloat(e.target.value),1/3),stop(),readInputForm()}function onInputLBox(e){let t=getFormsInputs();t.dens.value=Np/Math.pow(parseFloat(t.lbox.value),3),stop(),readInputForm()}function onInputNp(e){let t=getFormsInputs();t.lbox.value=Math.pow(getNp(t)/parseFloat(t.dens.value),1/3),stop(),readInputForm()}class Helper{static helpers=[];static helpDiv={};static initHelps(){var e=document.getElementsByClassName("helpIcon");this.helpDiv=document.getElementById("help"),this.helpDiv.addEventListener("click",this.mouseLeave);for(const t of e)this.helpers.push(new Helper(t).init())}constructor(e){this.innerHTML="",this.HTMLElement=e}init(){var e=this.HTMLElement.getElementsByClassName("helpText")[0];this.innerHTML=e.innerHTML,this.HTMLElement.removeChild(e),this.HTMLElement.addEventListener("click",e=>{this.mouseEnter(e,this)})}mouseEnter(e,t){Helper.helpDiv.classList.add("visible"),Helper.helpDiv.innerHTML=t.innerHTML}static mouseLeave(){Helper.helpDiv.classList.remove("visible")}}function createCamera(){cameras=[];var e=window.innerWidth/window.innerHeight;(camera=new THREE.OrthographicCamera(-e*Lbox.x,e*Lbox.x,Lbox.y,-Lbox.y,1,1e3)).position.set(0,0,20),camera.lookAt(0,0,0)}function createLights(){var e=new THREE.HemisphereLight(14544639,2105376,1);const t=new THREE.DirectionalLight(16777215,1);t.position.set(10,-10,10),scene.add(e,t)}function getMaterial(e){return new THREE.MeshStandardMaterial({color:e,flatShading:!0})}function createMaterials(){return{wall:new THREE.MeshStandardMaterial({color:16755268,flatShading:!0}),atom:new THREE.MeshStandardMaterial({color:4500223,flatShading:!0})}}function getGeometrie(e){return new THREE.SphereBufferGeometry(e,10,10)}function createGeometries(){return{wall:new THREE.PlaneBufferGeometry(30,30,1,1),atom:new THREE.SphereBufferGeometry(.5*sig,10,10)}}function createHelpers(){function e(e,t){var n=(new THREE.Vector3).copy(Lbox).multiplyScalar(-.55),t=new THREE.ArrowHelper(e,n,2,t,1,.5);scene.add(t)}e(new THREE.Vector3(1,0,0),16711680),e(new THREE.Vector3(0,1,0),65280),e(new THREE.Vector3(0,0,1),255)}function createSimBox(){let e;return e=ensemble.includes("wall")?new THREE.Mesh(new THREE.BoxGeometry(Lbox.x,1e3,Lbox.z),new THREE.MeshBasicMaterial({color:65280})):new THREE.Mesh(new THREE.BoxGeometry(Lbox.x,Lbox.y,Lbox.z),new THREE.MeshBasicMaterial({color:65280})),new THREE.BoxHelper(e,0)}function createMeshes(){simBox=createSimBox(),scene.add(simBox);for(let t=0;t<particles.length;t++)for(let e=0;e<particles[t].atoms.length;e++){const n=new THREE.Mesh(getGeometrie(particles[t].atoms[e].viewSize),getMaterial(particles[t].atoms[e].color));n.position.set(...Object.values(particles[t].atoms[e].r)),particles[t].atoms[e].r=n.position,scene.add(n)}}function createRenderer(){renderer=renderer||new THREE.WebGLRenderer;let e=document.getElementById("canvas--wrapper");void 0===(canvas=document.getElementsByTagName("canvas")[0])?(console.log("new canvas"),canvas=renderer.domElement,e.appendChild(canvas)):(console.log("replace old canvas"),canvas.parentNode.replaceChild(renderer.domElement,canvas)),renderer.physicallyCorrectLights=!1}function createControls(){(controls=new THREE.OrbitControls(camera,renderer.domElement)).enableKeys=!1,controls.enablePan=!1,controls.enableZoom=!0,(dragControlsBody=new THREE.DragControlsBody(dragObjects,camera,renderer.domElement)).addEventListener("dragstart",function(e){draged_name=e.object,controls.enabled=!1}),dragControlsBody.addEventListener("dragend",function(e){draged_name=0,controls.enabled=!0})}function ThreeJSInit(){(scene=new THREE.Scene).background=new THREE.Color(16777215),createCamera(),createLights(),createMeshes(),createRenderer(),createControls(),createHelpers(),onWindowResize()}function update(e){let t;for(t=0;t<e;t++)if(time+=dt,timeSteps++,newPosition(),force(),newVelocity(),timeSteps%100==0){if(crashTest())return stopRender(),stop(),void initAll();adaptivTimeStep(rijsqMin,sigMixMin),sigMixMin=rijsqMin=1}}function render(){renderer.render(scene,camera)}function playStop(){let e=document.getElementById("button--playStop");e.innerHTML=playSim?"&#x25b6":"&#x23f8",playSim=!playSim}function playRender(){console.log("play");let t=10;dt=.001,renderer.setAnimationLoop(()=>{var e;render(),playSim&&(e=(new Date).getTime(),update(t),printOutput(),(e=1e3/((new Date).getTime()-e))<15?(t--,t<1&&(t=1)):25<e&&t++)})}function stop(){let e=document.getElementById("button--playStop");e.innerHTML="&#x25b6",playSim=!1}function stopRender(){renderer.setAnimationLoop(null),console.log("stop")}function onWindowResize(){var e=document.getElementById("canvas--wrapper"),t=e.offsetWidth/e.offsetHeight;camera.left=-t*Lbox.x,camera.right=t*Lbox.x,camera.updateProjectionMatrix(),renderer.setSize(e.offsetWidth,e.offsetHeight,!0),renderer.render(scene,camera)}var camera,scene,renderer,material,geometry,canvas,controls,dragControls,dragControlsBody,MyWSModule,draged_name=-1,cameras=[],dragObjects=[],playSim=!1;function initSomething(){readTempInputFrom(),readPressInputFrom()}function initAll(){stop(),console.log("init all"),renderer&&stopRender(),time=0,readInputForm(),SimInit(),ThreeJSInit(),render(),OutputInit(),update(1),printOutput(),playRender()}function main(){window.WebGLRenderingContext?(setInputForm(),Helper.initHelps(),initAll(),window.addEventListener("resize",onWindowResize),document.getElementById("form__input--temp").addEventListener("change",initSomething),document.getElementById("form__input--press").addEventListener("change",initSomething),Array.prototype.map.call(document.getElementsByClassName("newSimIfChange"),e=>{e.addEventListener("change",initAll)}),window.addEventListener("focus",playRender),window.addEventListener("blur",stopRender)):(WEBGL.getWebGLErrorMessage(),console.log(Error))}output_init(),main();